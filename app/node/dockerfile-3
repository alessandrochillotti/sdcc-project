FROM golang:1.16-alpine

ARG ALGO
ENV ALGORITHM ${ALGO}

WORKDIR /app

COPY ./node/node-3.go ./node/node.go
COPY ./lib/lib-23.go ./lib/lib.go
COPY ./utils/utils-3.go ./utils/utils.go
COPY ./utils/vector_clock.go ./utils/vector_clock.go

RUN go mod init alessandro.it/app \
    && go mod tidy \
    && go mod download \
    && go build lib/lib.go \
    && go build -o main_node node/node.go

CMD [ "sh", "-c", "./main_node ${ALGORITHM}" ]